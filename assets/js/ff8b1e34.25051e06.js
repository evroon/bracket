"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[774],{5974:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>a});var o=t(4848),s=t(8453);const r={},c="Docker",d={id:"deployment/docker",title:"Docker",description:"This section describes how to deploy Bracket (frontend and backend) to docker using docker-compose.",source:"@site/docs/deployment/docker.md",sourceDirName:"deployment",slug:"/deployment/docker",permalink:"/docs/deployment/docker",draft:!1,unlisted:!1,editUrl:"https://github.com/evroon/bracket/tree/master/docs/docs/deployment/docker.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Cloud services",permalink:"/docs/deployment/cloud-services"},next:{title:"Nomad",permalink:"/docs/deployment/nomad"}},i={},a=[{value:"1. Install Docker and docker compose",id:"1-install-docker-and-docker-compose",level:2},{value:"2. Store the docker-compose.yml file",id:"2-store-the-docker-composeyml-file",level:2},{value:"3. Set up the environment variables",id:"3-set-up-the-environment-variables",level:2},{value:"4. Update volume bindings",id:"4-update-volume-bindings",level:2},{value:"5. Access the application",id:"5-access-the-application",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"docker",children:"Docker"}),"\n",(0,o.jsx)(n.p,{children:"This section describes how to deploy Bracket (frontend and backend) to docker using docker-compose."}),"\n",(0,o.jsx)(n.h2,{id:"1-install-docker-and-docker-compose",children:"1. Install Docker and docker compose"}),"\n",(0,o.jsx)(n.p,{children:"First, make sure you have docker and docker compose installed."}),"\n",(0,o.jsx)(n.h2,{id:"2-store-the-docker-composeyml-file",children:"2. Store the docker-compose.yml file"}),"\n",(0,o.jsxs)(n.p,{children:["Then, store the following YAML in a file called ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," in an empty directory."]}),"\n",(0,o.jsx)(n.p,{children:"The highlighted lines will be discussed in the next steps."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'services:\n    bracket-frontend:\n        image: ghcr.io/evroon/bracket-frontend\n        container_name: bracket-frontend\n        ports:\n            - "3000:3000"\n        environment:\n            NODE_ENV: "production"\n            // highlight-start\n            NEXT_PUBLIC_API_BASE_URL: "http://your-site.com:8400"\n            NEXT_PUBLIC_HCAPTCHA_SITE_KEY: "10000000-ffff-ffff-ffff-000000000001"\n            // highlight-end\n        restart: unless-stopped\n\n    bracket-backend:\n        image: ghcr.io/evroon/bracket-backend\n        container_name: bracket-backend\n        ports:\n            - "8400:8400"\n        environment:\n            ENVIRONMENT: "PRODUCTION"\n            // highlight-start\n            PG_DSN: "postgresql://bracket_prod:bracket_prod@postgres:5432/bracket_prod"\n            CORS_ORIGINS: https://your-site.com\n            JWT_SECRET: change_me\n            // highlight-end\n        volumes:\n            // highlight-next-line\n            - ./backend/static:/app/static\n        restart: unless-stopped\n        depends_on:\n          - postgres\n\n    postgres:\n        image: postgres\n        restart: always\n        environment:\n          POSTGRES_DB: bracket_prod\n          POSTGRES_USER: bracket_prod\n          POSTGRES_PASSWORD: bracket_prod\n        volumes:\n            // highlight-next-line\n          - ./postgres:/var/lib/postgresql/data\n'})}),"\n",(0,o.jsx)(n.h2,{id:"3-set-up-the-environment-variables",children:"3. Set up the environment variables"}),"\n",(0,o.jsx)(n.p,{children:"Replace the lines that are highlighted in the code block from the previous step."}),"\n",(0,o.jsxs)(n.p,{children:["Replace the following values for ",(0,o.jsx)(n.code,{children:"bracket-frontend"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"NEXT_PUBLIC_API_BASE_URL"}),": The address of your backend. The frontend will send\nrequests to this address."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"NEXT_PUBLIC_HCAPTCHA_SITE_KEY"}),": Either leave empty to disable it or\n",(0,o.jsx)(n.a,{href:"https://dashboard.hcaptcha.com/signup",children:"signup for hCaptcha"}),", create a site and\nput the site key here"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Replace the following values for ",(0,o.jsx)(n.code,{children:"bracket-backend"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"PG_DSN"}),": The DSN with format ",(0,o.jsx)(n.code,{children:"postgresql://<username>:<password>@<host>:<port>/<database>"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CORS_ORIGINS"}),": Put the address of your frontend here, it's used to make sure incoming requests\ncan only come from your actual frontend"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"JWT_SECRET"}),": Generate a secret to create JWTs using ",(0,o.jsx)(n.code,{children:"openssl rand -hex 32"})]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Note that your ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," file now contains secrets.\nIf you want a more secure setup, you can store secrets in separate files on the host and\nload them via ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/compose/use-secrets/",children:"docker secrets"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"4-update-volume-bindings",children:"4. Update volume bindings"}),"\n",(0,o.jsx)(n.p,{children:"Bracket needs two volume bindings: for the backend and for the database."}),"\n",(0,o.jsx)(n.p,{children:"Update the two volume binding paths to point to a directory where you want to store the\npersistent data."}),"\n",(0,o.jsx)(n.h2,{id:"5-access-the-application",children:"5. Access the application"}),"\n",(0,o.jsxs)(n.p,{children:["Run it using ",(0,o.jsx)(n.code,{children:"docker compose up -d"})," in the same directory as the file.\nAccess Bracket at ",(0,o.jsx)(n.code,{children:"http://localhost:3000"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>d});var o=t(6540);const s={},r=o.createContext(s);function c(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);